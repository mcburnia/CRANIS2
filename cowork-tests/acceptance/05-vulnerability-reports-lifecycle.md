# Test: Vulnerability Reports Lifecycle — Overview, Findings, CRA Report, Stages, Close

**Priority:** critical
**Preconditions:** User is logged in as org admin. At least one product exists with a completed vulnerability scan that has findings. The product has an SBOM generated.
**Test User:** testadmin@manufacturer-active.test / TestPass123!
**URL:** https://dev.cranis2.dev/login

## Steps

### Step 1 — Login
**Action:** Enter email `testadmin@manufacturer-active.test` and password `TestPass123!`. Click "Sign In".
**Expected:** User is redirected to the dashboard.

### Step 2 — Navigate to Vulnerability Overview
**Action:** In the sidebar, expand the "Compliance" section. Click "Vulnerabilities" or equivalent.
**Expected:** The vulnerability overview page loads showing:
- Summary statistics (total findings, severity breakdown)
- StatCards showing counts by severity (critical, high, medium, low)
- A list of products with their vulnerability status

### Step 3 — View Product-Level Findings
**Action:** Click on a product that has vulnerability findings.
**Expected:** The product vulnerability detail page loads showing:
- List of individual findings/vulnerabilities
- Each finding shows: CVE ID (if applicable), severity, package name, description
- Severity is correctly normalised ("moderate" displayed as "medium")
- Findings count matches the `findings_count` field

### Step 4 — Review a Specific Finding
**Action:** Click on a specific vulnerability finding to view its details.
**Expected:** The finding detail view shows:
- Full vulnerability description
- Affected package and version
- Severity level with colour indicator (red for critical, amber for high, etc.)
- Remediation advice or links (if available)

### Step 5 — Create a CRA Report
**Action:** Click "Create CRA Report" or "New Report" for a vulnerability that requires reporting under the Cyber Resilience Act.
**Expected:** A CRA report creation form or dialog appears with fields for:
- Vulnerability reference
- Initial assessment
- Report type or stage selection

### Step 6 — Submit Early Warning Stage
**Action:** Fill in the early warning details. Select stage "early_warning". Submit the form.
**Expected:** A success message appears. The report is created with status "early_warning". The report appears in the reports list with this stage indicated.

### Step 7 — Progress to Notification Stage
**Action:** Open the CRA report created in Step 6. Click "Submit Notification" or advance to the "notification" stage. Fill in any required notification details.
**Expected:** A success message appears. The report stage updates to "notification". The stage progression is visible in the report timeline or status indicator.

### Step 8 — Close the Report
**Action:** Click "Close Report" or mark the report as resolved/closed. Provide a closing note if required.
**Expected:** A success message appears. The report status changes to "closed" or "resolved". The report remains visible in the history but is marked as closed.

### Step 9 — Verify Report in History
**Action:** Navigate back to the vulnerability reports list or CRA reports section.
**Expected:** The closed report appears in the list with:
- Closed status indicator
- All stage transitions visible (early_warning -> notification -> closed)
- Timestamps for each stage transition

## Pass Criteria
- [ ] Vulnerability overview page loads with summary statistics
- [ ] Product-level findings display with correct severity levels
- [ ] Individual finding details are accessible and complete
- [ ] A CRA report can be created for a vulnerability
- [ ] Early warning stage submits successfully
- [ ] Notification stage submits successfully
- [ ] Report can be closed with final status update
- [ ] Report history shows all stage transitions

## Result
**Status:** passed
**Notes:** All steps verified. Defects found during testing have been resolved and re-verified.
